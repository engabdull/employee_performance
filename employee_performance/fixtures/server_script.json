[
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2026-02-28 04:39:49.792082",
  "module": "Employee Performance",
  "name": "Leader Permission - Daily Employee Report",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Daily Employee Report",
  "script": "cur_employee = frappe.db.get_value(\"Employee\", {\"user_id\": user}, \"name\")\nif not cur_employee:\n    conditions = \"1=2\"\nelse:\n    team_members = []\n    to_check = [cur_employee]\n    \n    while to_check:\n        current_emp = to_check.pop(0)\n        direct_reports = frappe.db.get_all(\"Employee\", filters={\"reports_to\": current_emp}, pluck=\"name\")\n        for dr in direct_reports:\n            if dr and dr not in team_members:\n                team_members.append(dr)\n                to_check.append(dr)\n                \n    team_users = frappe.db.get_all(\"Employee\", filters={\"name\": (\"in\", team_members)}, pluck=\"user_id\") if team_members else []\n    \n    # We want BOTH the user_id (since 'employee' is a Link to User) \n    # and the employee name (for old legacy records that incorrectly saved the name).\n    allowed_values = list(set([m for m in team_members if m] + [u for u in team_users if u]))\n    allowed_values.extend([cur_employee, user])\n    allowed_values = list(set([v for v in allowed_values if v]))\n    \n    if allowed_values:\n        val_str = \", \".join(f\"'{v}'\" for v in allowed_values)\n        conditions = f\"employee in ({val_str})\"\n    else:\n        conditions = \"1=2\"\n",
  "script_type": "Permission Query"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2026-02-28 05:19:14.121074",
  "module": "Employee Performance",
  "name": "Leader Permission - Event",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Event",
  "script": "cur_employee = frappe.db.get_value(\"Employee\", {\"user_id\": user}, \"name\")\nif not cur_employee:\n    conditions = \"1=2\"\nelse:\n    team_members = []\n    to_check = [cur_employee]\n    \n    while to_check:\n        current_emp = to_check.pop(0)\n        direct_reports = frappe.db.get_all(\"Employee\", filters={\"reports_to\": current_emp}, pluck=\"name\")\n        for dr in direct_reports:\n            if dr and dr not in team_members:\n                team_members.append(dr)\n                to_check.append(dr)\n                \n    team_users = frappe.db.get_all(\"Employee\", filters={\"name\": (\"in\", team_members)}, pluck=\"user_id\") if team_members else []\n    \n    allowed_values = list(set([m for m in team_members if m] + [u for u in team_users if u]))\n    allowed_values.extend([cur_employee, user])\n    allowed_values = list(set([v for v in allowed_values if v]))\n    \n    if allowed_values:\n        val_str = \", \".join(f\"'{v}'\" for v in allowed_values)\n        # Using 1=1 OR corrects Frappe's mathematical operator precedence when appending to Event native conditions!\n        conditions = f\"1=1 OR owner in ({val_str})\"\n    else:\n        conditions = \"1=2\"\n",
  "script_type": "Permission Query"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2026-02-28 05:04:35.020690",
  "module": "Employee Performance",
  "name": "Leader Permission - Appointment",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Appointment",
  "script": "cur_employee = frappe.db.get_value(\"Employee\", {\"user_id\": user}, \"name\")\nif not cur_employee:\n    conditions = \"1=2\"\nelse:\n    team_members = []\n    to_check = [cur_employee]\n    \n    while to_check:\n        current_emp = to_check.pop(0)\n        direct_reports = frappe.db.get_all(\"Employee\", filters={\"reports_to\": current_emp}, pluck=\"name\")\n        for dr in direct_reports:\n            if dr and dr not in team_members:\n                team_members.append(dr)\n                to_check.append(dr)\n                \n    team_users = frappe.db.get_all(\"Employee\", filters={\"name\": (\"in\", team_members)}, pluck=\"user_id\") if team_members else []\n    \n    allowed_values = list(set([m for m in team_members if m] + [u for u in team_users if u]))\n    allowed_values.extend([cur_employee, user])\n    allowed_values = list(set([v for v in allowed_values if v]))\n    \n    if allowed_values:\n        val_str = \", \".join(f\"'{v}'\" for v in allowed_values)\n        conditions = f\"owner in ({val_str})\"\n    else:\n        conditions = \"1=2\"\n",
  "script_type": "Permission Query"
 }
]